<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å¤šäººé€£ç·šç¹ªåœ–æ¿ (æœ€çµ‚ä½ˆå±€)</title>
    
    <style>
        /* --- CSS æ ¸å¿ƒæ”¹å‹• --- */
        body { touch-action: none; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background-color: #f0f0f0; margin: 0; padding: 10px; box-sizing: border-box; }
        h1 { color: #333; text-align: center; margin-bottom: 10px; }
        .toolbar { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 15px; background-color: #ffffff; padding: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 15px; width: 95%; max-width: 800px; box-sizing: border-box;}
        label { font-weight: bold; }
        input[type="color"] { width: 40px; height: 40px; border: none; padding: 0; cursor: pointer; background: none; }
        button { padding: 8px 15px; border: none; background-color: #e74c3c; color: white; font-size: 16px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #c0392b; }

        /* --- ä½ˆå±€çš„é­”æ³•å°±åœ¨é€™è£¡ --- */
        #canvas-container {
            width: 95%;
            max-width: 800px; /* é™åˆ¶ç•«å¸ƒæœ€å¤§å¯¬åº¦ï¼Œé¿å…åœ¨è¶…å¯¬è¢å¹•ä¸Šéå¤§ */
            margin: 0 auto;
            
            /* 1. è¨­å®šé•·å¯¬æ¯”ç‚º 16:9 */
            aspect-ratio: 16 / 9;
            
            /* 2. ç‚ºäº†è®“å…§éƒ¨çš„ canvas çµ•å°å®šä½ */
            position: relative; 
            
            border: 2px solid #00c2a8;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 4px;
        }

        #drawingCanvas {
            /* 3. è®“ç•«å¸ƒå¡«æ»¿å®ƒçš„å®¹å™¨ */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            
            background-color: #ffffff;
            cursor: crosshair;
        }
    </style>

    <!-- Firebase å¼•ç”¨ä¿æŒä¸è®Š -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
    <h1>å¤šäººé€£ç·šç¹ªåœ–æ¿ ğŸ¨</h1>
    <div class="toolbar">
        <label for="colorPicker">é¡è‰²:</label>
        <input type="color" id="colorPicker" value="#000000">
        <label for="lineWidth">ç²—ç´°:</label>
        <input type="range" id="lineWidth" min="1" max="50" value="5">
        <span id="lineWidthValue">5</span>
        <button id="clearBtn">å…¨éƒ¨æ¸…é™¤</button>
    </div>
    
    <div id="canvas-container">
        <canvas id="drawingCanvas"></canvas>
    </div>

    <script>
        // è«‹ç¹¼çºŒä½¿ç”¨æ‚¨è‡ªå·±çš„ Firebase è¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyC2yDx3yu7yj_mQWYlI6Ivs9b2qgdSEh6s",
  authDomain: "ai-drawing-game.firebaseapp.com",
  projectId: "ai-drawing-game",
  storageBucket: "ai-drawing-game.firebasestorage.app",
  messagingSenderId: "918732328621",
  appId: "1:918732328621:web:3d6f8e42cbc64e3d6a0024",
  measurementId: "G-6WBPNSYRRJ"

        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const drawingsRef = database.ref('drawings');

        window.addEventListener('load', () => {
            const canvasContainer = document.getElementById('canvas-container');
            const canvas = document.getElementById('drawingCanvas');
            const ctx = canvas.getContext('2d');
            // ...å…¶ä»–å…ƒç´ ...
            const colorPicker = document.getElementById('colorPicker');
            const lineWidthInput = document.getElementById('lineWidth');
            const lineWidthValue = document.getElementById('lineWidthValue');
            const clearBtn = document.getElementById('clearBtn');
            
            let drawingHistory = [];

            // --- JS æ ¸å¿ƒæ”¹å‹• ---
            function resizeCanvas() {
                // ç¾åœ¨ JS çš„ä»»å‹™è®Šå¾—éå¸¸ç°¡å–®ï¼
                // CSS å·²ç¶“ç¢ºä¿äº†å®¹å™¨çš„æ¯”ä¾‹ï¼ŒJS åªéœ€è¦è®“ç•«å¸ƒçš„ç¹ªåœ–å°ºå¯¸ç­‰æ–¼å®¹å™¨çš„é¡¯ç¤ºå°ºå¯¸å³å¯
                canvas.width = canvasContainer.offsetWidth;
                canvas.height = canvasContainer.offsetHeight;
                redrawAll();
            }

            function redrawAll() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawingHistory.forEach(drawLineOnCanvas);
            }

            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // å…¶ä»–æ‰€æœ‰ç¹ªç•«ã€åŒæ­¥ã€åº§æ¨™è½‰æ›çš„é‚è¼¯ï¼Œå®Œå…¨ä¸éœ€è¦æ”¹è®Šï¼
            // é€™æ˜¯è‰¯å¥½æ¶æ§‹çš„å¥½è™•ï¼Œä¿®æ”¹ä½ˆå±€ä¸éœ€è¦å‹•æ ¸å¿ƒé‚è¼¯ã€‚
            let isDrawing = false;
            let lastX = 0; let lastY = 0;
            function draw(e) {
                if (!isDrawing) return;
                e.preventDefault();
                const [currentX, currentY] = getCoords(e);
                const lineData = {
                    startX_norm: lastX / canvas.width, startY_norm: lastY / canvas.height,
                    endX_norm: currentX / canvas.width, endY_norm: currentY / canvas.height,
                    color: colorPicker.value, width: lineWidthInput.value
                };
                drawingsRef.push(lineData);
                [lastX, lastY] = [currentX, currentY];
            }
            function drawLineOnCanvas(data) {
                const startX = data.startX_norm * canvas.width; const startY = data.startY_norm * canvas.height;
                const endX = data.endX_norm * canvas.width; const endY = data.endY_norm * canvas.height;
                ctx.strokeStyle = data.color; ctx.lineWidth = data.width;
                ctx.lineCap = 'round'; ctx.lineJoin = 'round';
                ctx.beginPath(); ctx.moveTo(startX, startY); ctx.lineTo(endX, endY); ctx.stroke();
            }
            drawingsRef.on('child_added', (snapshot) => {
                const data = snapshot.val();
                drawingHistory.push(data);
                drawLineOnCanvas(data);
            });
            drawingsRef.on('child_removed', () => {
                drawingHistory = [];
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            });
            clearBtn.addEventListener('click', () => { drawingsRef.remove(); });
            function startDrawing(e) { isDrawing = true; [lastX, lastY] = getCoords(e); }
            function stopDrawing() { isDrawing = false; }
            function getCoords(e) {
                if (e.touches && e.touches.length > 0) {
                    const rect = canvas.getBoundingClientRect();
                    return [e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top];
                }
                return [e.offsetX, e.offsetY];
            }
            canvas.addEventListener('mousedown', startDrawing); canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing); canvas.addEventListener('mouseout', stopDrawing);
            canvas.addEventListener('touchstart', startDrawing); canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);
            lineWidthInput.addEventListener('input', (e) => { lineWidthValue.textContent = e.target.value; });
        });
    </script>
</body>
</html>